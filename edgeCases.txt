==========================
ğŸš€ TAXI BOOKING API TEST CASES
==========================

âœ… 1) POST /auth/send-otp
---------------------------------
âœ… Valid mobile number
âœ… Invalid mobile number (e.g., too short, wrong format)
âœ… Missing mobile number
âœ… Send OTP for an existing user with no role
âœ… Send OTP with role: driver
âœ… Send OTP with role: passenger

âœ… 2) POST /auth/verify-otp
---------------------------------
âœ… Valid OTP, correct mobile
âœ… Invalid OTP
âœ… Expired OTP
âœ… Missing OTP
âœ… Missing mobile
âœ… User without OTP saved
âœ… User with OTP but wrong format mobile

âœ… 3) POST /auth/login
---------------------------------
âœ… Valid mobile and correct password
âœ… Valid mobile but wrong password
âœ… Valid mobile but no password set (force error)
âœ… Invalid mobile
âœ… Missing mobile or password

âœ… 4) POST /auth/forgot-password
---------------------------------
âœ… Valid mobile, user exists
âœ… Invalid mobile format
âœ… Mobile not found in DB
âœ… Missing mobile

âœ… 5) POST /auth/reset-password
---------------------------------
âœ… Valid mobile, valid OTP, valid new password
âœ… Valid mobile, invalid OTP
âœ… Expired OTP
âœ… Missing mobile, OTP or newPassword
âœ… New password too short

âœ… 6) POST /rides/search
---------------------------------
âœ… Valid pickup, drop, rideTime
âœ… Missing pickup
âœ… Missing drop
âœ… Missing rideTime
âœ… Invalid rideTime format

âœ… 7) GET /rides/available
---------------------------------
âœ… Valid pickup, drop, rideTime matches
âœ… Valid pickup/drop but no rides match
âœ… rideTime with wrong format (CastError)
âœ… rideTime outside available range
âœ… Missing pickup/drop/rideTime

âœ… 8) POST /rides/request
---------------------------------
âœ… Valid rideId, valid passenger JWT
âœ… Invalid rideId
âœ… Missing rideId
âœ… Ride doesnâ€™t exist
âœ… Using driver token instead of passenger (role check)
âœ… Same passenger requests same ride again

âœ… 9) POST /rides/verify-ride-otp
---------------------------------
âœ… Valid rideId, valid OTP, driver owns ride
âœ… Valid rideId, wrong OTP
âœ… Valid rideId, but driver does not own ride
âœ… Valid OTP but ride in wrong status
âœ… Missing rideId or OTP
âœ… Using passenger JWT instead of driver

âœ… 10) POST /rides/cancel
---------------------------------
âœ… Valid rideRequestId, valid passenger JWT
âœ… Missing rideRequestId
âœ… Invalid rideRequestId
âœ… Passenger tries to cancel someone elseâ€™s request
âœ… Using driver JWT instead of passenger
âœ… Cancel with reason field
âœ… Cancel with missing reason field

==========================
ğŸ“Œ GENERAL HEADERS:
- For protected routes: Add header `x-auth-token` with valid JWT for the role.
- Always test: expired or invalid token â†’ expect 401.
==========================

âœ… Done!




























---------------------------------------------------------

==========================
ğŸš– TAXI BOOKING BACKEND â€” COMPLETE FLOW TEST PLAN
==========================

This covers:
âœ… Auth: OTP, login, reset
âœ… Rides: Search, Available, Request, Verify OTP, Cancel
âœ… Manual DB steps for now (no /createRide yet)

Use these steps IN ORDER during testing!

==========================
ğŸ—‚ï¸ DB: taxiBookingDB
Collections:
  - users
  - rides
  - rideRequests
==========================

âœ… STEP 1ï¸âƒ£: CREATE USERS MANUALLY
---------------------------------

a) Create a DRIVER:
--------------------
Run in Mongo shell:
db.users.insertOne({
  name: "Test Driver",
  mobile: "8888888888",
  password: "$2b$10$1Dp6jQrWQTYXrnMu5HE.zOwr.rxQfInyHutvT/XcQDuziuo6i0CVK", // bcrypt for 'password'
  role: "driver",
  otp: null,
  otpExpiresAt: null,
  createdAt: new Date()
})

b) Create a PASSENGER:
--------------------
db.users.insertOne({
  name: "Test Passenger",
  mobile: "9999999999",
  password: "$2b$10$XB5N340P7a4vKsmUgPZ2DOScB0yt7N3tTjhp6oEXEsYuQYAOoK.vW", // bcrypt for 'password'
  role: "passenger",
  otp: null,
  otpExpiresAt: null,
  createdAt: new Date()
})

c) Confirm:
--------------------
db.users.find().pretty()

âœ… Save the driverâ€™s `_id` for step 2.

==========================
âœ… STEP 2ï¸âƒ£: CREATE DUMMY RIDE
---------------------------------

Insert a ride with driverId from step 1:
db.rides.insertOne({
  driverId: ObjectId("YOUR_DRIVER_ID"),
  pickup: "Location A",
  drop: "Location B",
  rideTime: ISODate("2025-07-07T10:00:00Z"),
  status: "available",
  startOtp: "654321"
})

âœ… Confirm:
db.rides.find().pretty()

==========================
âœ… STEP 3ï¸âƒ£: PASSENGER SENDS OTP & VERIFIES (FOR LOGIN)
---------------------------------
ğŸ”¹ POST /api/auth/send-otp
Body: { "mobile": "9999999999" }

ğŸ”¹ POST /api/auth/verify-otp
Body: { "mobile": "9999999999", "otp": "<otp from console>" }

âœ… Copy the token for passenger â€” youâ€™ll use this for `/request`.

==========================
âœ… STEP 4ï¸âƒ£: DRIVER LOGIN (OPTIONAL)
---------------------------------
ğŸ”¹ POST /api/auth/login
Body: { "mobile": "8888888888", "password": "password" }

âœ… Copy the driver token â€” youâ€™ll use this for `/verify-ride-otp`.

==========================
âœ… STEP 5ï¸âƒ£: PASSENGER SEARCHES & GETS AVAILABLE RIDES
---------------------------------

ğŸ”¹ POST /api/rides/search
Body: { "pickup": "Location A", "drop": "Location B", "rideTime": "2025-07-07T10:00:00Z" }

ğŸ”¹ GET /api/rides/available
Query: ?pickup=Location A&drop=Location B&rideTime=2025-07-07T10:00:00Z

âœ… Confirm you see your dummy ride.
âœ… Save rideId for request.

==========================
âœ… STEP 6ï¸âƒ£: PASSENGER SENDS REQUEST TO JOIN RIDE
---------------------------------
ğŸ”¹ POST /api/rides/request
Headers: x-auth-token: <Passenger JWT>
Body: { "rideId": "YOUR_RIDE_ID" }

âœ… Confirm response: success true.
âœ… Check in DB:
db.rideRequests.find().pretty()

==========================
âœ… STEP 7ï¸âƒ£: DRIVER VERIFIES START OTP
---------------------------------
ğŸ”¹ POST /api/rides/verify-ride-otp
Headers: x-auth-token: <Driver JWT>
Body:
{
  "rideId": "YOUR_RIDE_ID",
  "otp": "654321"
}

âœ… For testing, your ride status should be 'available' or manually updated to 'scheduled' if your verify logic only allows that.

âœ… After success: status moves to 'active', startOtp cleared.

==========================
âœ… STEP 8ï¸âƒ£: PASSENGER CANCELS REQUEST (OPTIONAL)
---------------------------------
ğŸ”¹ POST /api/rides/cancel
Headers: x-auth-token: <Passenger JWT>
Body:
{
  "rideRequestId": "YOUR_REQUEST_ID",
  "reason": "Change of plan"
}

âœ… Confirm status in DB:
db.rideRequests.find().pretty()

==========================
âœ… GENERAL HEADERS
---------------------------------
Always use:
- Header: x-auth-token: <your JWT> for protected routes.
- If no token, should return 401.
- Wrong role? Should return 403.

==========================
âœ… EDGE CASES FOR EACH ENDPOINT
---------------------------------
âœ… For each API test:
 - Missing fields
 - Invalid formats (mobile, OTP)
 - Invalid token
 - Expired OTP
 - Non-existent IDs
 - Wrong role tries to access
 - Happy path always!

==========================
ğŸ‰ DONE!
You now have a full manual flow for all your 10 APIs until you build `/createRide` for real driver ride creation.
==========================
